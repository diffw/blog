{{ define "main" }}
{{ if .Content }}
<div class="home-page-content">
  {{/* 获取 now.md 页面 */}}
  {{ $nowPage := .Site.GetPage "page" "now" }}
  {{ $nowFirstModule := "" }}
  {{ if $nowPage }}
    {{ $nowContent := $nowPage.RawContent }}
    {{/* 按行分割内容 */}}
    {{ $lines := split $nowContent "\n" }}
    {{/* 提取第 8 行到第 11 行之间的内容（索引 7-10，因为索引从 0 开始，end 不包含） */}}
    {{ if ge (len $lines) 11 }}
      {{ $selectedLines := slice $lines 7 11 }}
      {{ $nowFirstModule = delimit $selectedLines "\n" }}
    {{ end }}
    {{/* 清理前后空白并渲染为 Markdown */}}
    {{ if $nowFirstModule }}
      {{ $nowFirstModule = $nowFirstModule | strings.TrimSpace | .RenderString }}
    {{ end }}
  {{ end }}
  
  {{/* 获取最新的一篇博客 */}}
  {{ $posts := .Site.GetPage "section" "posts" }}
  {{ $latestPostContent := "" }}
  {{ if $posts }}
    {{ $sortedPosts := sort $posts.Pages "Date" "desc" }}
    {{ if gt (len $sortedPosts) 0 }}
      {{ $latestPost := index $sortedPosts 0 }}
      {{ $excerpt := $latestPost.Content | plainify | truncate 200 }}
      {{ $latestPostContent = printf "<div class=\"latest-post-preview\"><h3><a href=\"%s\">%s</a></h3><div class=\"post-date\">%s</div><div class=\"post-excerpt\">%s</div></div>" $latestPost.Permalink $latestPost.Title ($latestPost.Date.Format "January 2, 2006") $excerpt }}
    {{ end }}
  {{ end }}
  
  {{/* 获取原始内容并替换占位符，然后渲染 */}}
  {{ $rawContent := .RawContent }}
  {{ if and $nowFirstModule (ne $nowFirstModule "") }}
    {{ $rawContent = replace $rawContent "/读取 now.md 第一个模块的内容" $nowFirstModule }}
  {{ end }}
  {{ if and $latestPostContent (ne $latestPostContent "") }}
    {{ $rawContent = replace $rawContent "/读取 https://nanwang.art/posts/ 第一篇blog" $latestPostContent }}
  {{ end }}
  
  {{/* 渲染处理后的内容 */}}
  {{ $rawContent | .RenderString }}
</div>
{{ else }}
<div class="home-page">
  <div class="posts-list">
    {{ $posts := .Site.GetPage "section" "posts" }}
    {{ range first 10 $posts.Pages }}
    <article class="post-card">
      <div class="post-content-preview">
        {{ $content := .Content | plainify }}
        {{ $contentLength := len $content }}
        {{ if gt $contentLength 1000 }}
          {{ $truncated := $content | truncate 1000 }}
          <div class="post-content-full">{{ $truncated }}</div>
          <a href="{{ .Permalink }}" class="read-more">Read more...</a>
        {{ else }}
          <div class="post-content-full">{{ $content }}</div>
        {{ end }}
      </div>
      <div class="post-meta-bottom">
        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
        {{ if .Params.tags }}
        <div class="post-tags">
          {{ range .Params.tags }}
          <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="tag">#{{ . }}</a>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </article>
    {{ end }}
  </div>
  
  {{ if gt (len $posts.Pages) 10 }}
  <div class="more-posts">
    <a href="{{ "/posts/" | relLangURL }}" class="btn">View More Posts →</a>
  </div>
  {{ end }}
</div>
{{ end }}
{{ end }}

